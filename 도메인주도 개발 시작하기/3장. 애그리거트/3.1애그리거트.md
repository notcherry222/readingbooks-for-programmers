  
## 3.1 애그리거트 

개발을 할 때, 상위 개념을 이용해서 전체 모델을 정리하면 전체적인 관계를 이해하는 데 도움이 된다. 이와 같이 복잡한 도메인을 이해하기 용이한 단위로 만들어 도메인 요소간의 관계를 파악하기 쉽게 만든 방법이 애그리거트이다. 애그리거트는 관련 객체를 하나의 군으로 묶어주기 때문에, 상위 수준에서 도메인 모델 간의 관계를 파악하기 쉽다. 애그리거트를 이용하면, 애그리거트 단위로 일관성을 관리하기 때문에 복잡한 도메인 구조를 단순하게 만들어 준다. 복잡도가 낮아지는 만큼 도메인 기능을 확장하고 변경하는 데 필요한 개발 시간도 줄어든다.  
애그리거트의 같은 경계에 속한 객체는 유사한 라이프 사이클을 갖는다. 각 애그리거트는 독립된 객체 군이라 다른 애그리거트를 관리하지 않는다. 예를 들어, 주문 애그리거트에서 상품의 가격을 변경하지 않는다.  
경계를 설정할 때 기본이 되는 것은 도메인 규칙과 요구사항이다. 도메인 규칙에 따라 함께 생성되는 구성요소는 한 애그리거트에 속할 가능성이 높다. 대부분 애그리거트가 한 개의 엔티티를 갖는다.  
  
  
  
## 3.2 애그리거트 루트  
  
도메인 규칙을 유지하려면 애그리거트에 속한 모든 객체가 일관된 상태를 유지하려면 애그리거트 전체를 관리할 주체가 필요한데 이 책임을 지는 것이 바로 애그러트의 루트 엔티티이다. 애그리거트 루트 엔티티는 애그리거트의 대표 엔티티이다.  
애그리거트 루트는 단순히 애그리거트에 속한 객체를 포함하는 것 뿐만 아니라 일관성이 깨지지 않도록 하는 핵심 역할을 한다.  
애그리거트 외부에서 애그리거트에 속한 객체를 직접 변경하면 안 된다. 이것은 일관성을 깨는 원이 될 수 있기 때문이다. 애그리거트 루트를 통해서만 도메인 로직을 구현하게 만들려면 도메인 모델에 대해 다음 두 가지를 주의해야 한다.  
1. 단순히 필드를 변경를 변경하는 set 메서드를 public 범위로 만들지 않는다.  
2. 밸류 타입은 불변으로 한다.  
  
애그리겉트 루트는 애그리거트 내부의 객체를 조합해서 완성한다.  
  
### 트랜잭션 범위  
  
**<권장 사항>**  
1. 트랜잭션 범위는 작을수록 좋다.  
2. 한 트랜잭션에서는 한 개의 애그리거트만 수정해야 한다. 두 개 이상의 애그리거트를 수정하면 트랜잭션 충돌이 발생할 가능성이 높기 때문이다. 또한, 애그리거트가 다른 애그리거트의 기능에 의존하게 된다면 결합도가 높아져 향후 수정 비용이 증가하므로 자기를 제외한 다른 애그리거트의 상태를 변경하지 말아야 한다. 부득이한 상황에서는 직접 수정하지 말고, 응용 서비스에서 두 애그리거트를 수정하도록 구현해야 한다.  
  
**<부득이한 경우>**  
1. 팀 표준 : 조직의 표준에 따라 사용자 유스케이스와 관련된 응용 서비스의 기능을 한 트랜잭션으로 실행해야 하는 경우  
2. 기술 제약 : 기술적으로 이벤트 방식을 도입할 수 없는 경우 한 트랜잭션에서 다수의 애그리거트를 수정해서 일관성을 처리  
3. UI 구현의 편리 : 운영자의 편리함을 위해 트랜잭션에서 여러 애그리거트의 상태를 변경.