  

### 6.1 표현 영영과 응용 영역  
  
도메인이 제 기능을 하려면 사용자와 도메인을 연결해 주는 매개체가 필요하다. 사용자와 도메인을 연결해주는 것이 바로 표현 영영과 응용 영역이다.  
표현 영역은 사용자의 요청을 해석한다. 사용자가 전송 버튼을 누르면, 요청 파라미터를 포함한 HTTP 요청을 표현 영역에 전달한다. 요청을 받은 표현 영역은 URL, 요청 파라미터, 쿠키, 헤더 등을 이용해 사용자가 실행하고 싶은 기능을 판별하고 기능을 제공한다. 이러한 기능을 제공하는 것은 응용 영역에 위치한 서비스이다.  
표현 영역은 응용 서비스가 요구하는 형식으로 사용자 요청을 변환한다. 응용 서비스를 실행한 뒤에 표현 영역은 실행 결과를 사용자에게 알맞은 형식으로 응답한다. 주로 HTML 이나 JSON 형식으로 응답한다.  
사용자와 상호작용은 표현 영역에서 처리하기 때문에 응용 서비스는 표현 영역에 의존하지 않는다.  
  


### 6.2 응용 서비스의 역할  

응용 서비스는 사용자의 요청을 처리하기 위해 리포지터리에서 도메인 객체를 가져와 사용한다. 또한 응용 서비스는 트랜잭션 처리도 담당한다.   
도메인 로직을 응용 서비스와 구분하여 도메인 영역에 구현해야 하는 것을 주의해야 한다. 만약, 그러지 못 했다면 응집도가 떨어지고 코드 중복이 발생하는 문제가 생긴다. 따라서 도메인 로직은 도메인 영역에 구현한 후 응용 서비스에서 가져와 사용만 해야 한다.  



### 6.3 응용 서비스 구현  

응용 서비스는 표현 영역과 도메인 영역을 연결하는 매개체 역할을 하는데 이는 디자인 패턴 중 파사드 패턴과 같은 역할을 한다.  
응용 서비스 자체의 구현은 어렵지 않지만 고려해야 할 사항이 있다. 그 중 하나가 **응용 서비스의 크기**이다. 서비스의 크기는 여기서 코드 줄 수라고 보면 된다. 크기가 커지면 코드가 복잡해지고 통일성이 떨어지므로 클래스로 나누는 것이 좋다. 이렇게 하면 클래스 개수는 많아지지만 한 클래스에 관련 기능을 모두 구현할 수 있어 코드 품질을 일정 수준으로 유지하는 데 도움이 된다. 또한 각 클래스별로 필요한 의존 객체만 포함하므로 다른 기능을 구현한 코드에 영향을 받지 않는다.   
응용서비스를 구현할 때는 **인터페이스가 필요한 상황인지** 잘 고려해야 한다.  
  


### 6.4 표현 영역  
  
표현 영역의 세 가지 역할  
1. 사용자가 시스템을 사용할 수 있는 **화면을 제공하고 제어**한다.  
2. 사용자의 **요청을 알맞은 응용 서비스에 전달**하고 결과를 사용자에게 제공한다.  
3. 사용자의 **세션을 관리**한다.  
  
  

### 6.5 값 검증  
  
값 검증은 원칙적으로는 응용서비스에서 처리하지만 표현 영역에서도 가능하다. 예를 들어, 사용자에게 잘못된 값을 입력받은 경우, 에러 메시지를 보여준 후 다시 올바른 값을 입력받을 수 있다. 응용 서비스에서 각 값의 유효성을 확인하기 위해 익셉션을 사용하는 것은 좋지 않다. 응용 서비스에서는 첫 번째 값이 올바르지 않다면 나머지 항목에 대해서는 값을 검사하지 않기 때문이다. 이는 사용자가 같은 폼에 값을 여러번 입력하게 만들어 불편함을 초래한다.  
**표현 영역에서 필수 값과 값의 형식 정도를 검사해주면, 실질적으로 응용 서비스는 ID 중복 여부와 같은 데이터 존재 유무와 같은 논리적 오류만 검사하면 된다.** 이렇게 역할을 나누어 검증을 수행하면, 구현의 편리함을 얻을 수도 있다.  
  
  

### 6.6 권한 검사
  
일반적으로 **표현 영역, 응용 서비스, 도메인** 이 세 곳에서 권한 검사를 할 수 있다. 표현 영역에서는 간단한 인증을 통해 권한 검사를 한다.(회원 여부) url만으로 접근 제어를 할 수 없는 경우에는 응용 서비스에서 메서드 단위로 검사를 진행한다.(관리자/유저 판별) 도메인 객체 수준의 권한 검사는 애그리거트를 로딩해야 하기 때문에 구현이 더 복잡하다.(게시글 삭제를 하기 전 삭제 권한 검사)  
  


### 6.7 조회 전용 기능과 응용 서비스  

단순 조회 기능을 수행할 때는 표현 영역에서 바로 조회 전용 기능을 사용해도 문제가 없다. 응용 서비스가 사용자 요청 기능을 실행하는 데 별다른 기여를 하지 않는다면 서비스를 만들지 않아도 된다.  
```java
public class Controller {
    private OrderViewDao dao;


    @RequestMapping("/orders")
    public String list(ModelMap map) {
        String orderId = SecurityContext.getAuthentication().getId();
        List<OrderView> orders = dao.selectByOrder(orderId);
        map.addAttribute("orders", orders);
        return "order/list";
    }
}
```