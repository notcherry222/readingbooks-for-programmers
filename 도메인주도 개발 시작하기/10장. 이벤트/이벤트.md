  

### 10.1 시스템 간 강결합 문제  
  
환불 처리를 진행하고자 할때 발생할 수 있는 시스템적 오류를 생각해보자.  
첫 번째로, **외부 서비스가 정상이 아닐 경우 트랜잭션 처리**를 어떻게 해야 할까? 환불 기능을 실행하는 과정에서 예외가 발생하면 트랜잭션을 롤백해야 할까? 커밋해야 할까?  
이 상황에서는 환불에 실패했으므로 주문 취소 트랜잭션을 롤백하는 것이 맞아 보인다. 하지만 반드시 이 방향이 맞는 것은 아니다. 주문은 취소 상태로 변경하고 환불만 나중에 다시 시도하는 방식으로 처리할 수 있다.  
두 번째 문제는 **성능**에 대한 것이다. 환불을 처리하는 외부 시스템의 응답 시간이 길어지면 그만큼 대기 시간도 길어진다. 환불 처리 기능이 30초가 걸리면 주문 취소는 그만큼 대기 시간이 증가하는 것이다.  
세 번째로 **도메인 객체에 서비스를 전달하면 추가로 설계상 문제**가 나타날 수 있다. 주문로직과 결제로직이 섞이는 문제이다.  
이 문제들이 발생하는 공통적인 이유는 주문 바운디드 컨텍스트와 결제 바운디드 컨텍스트 간의 강결합때문이다. 주문이 결제와 강하게 연결되어 있어 주문 바운디드 컨텍스트가 결제 바운디드 컨텍스트에 영향을 받게 되는 것이다.  
이런 경합을 없애기 위해 우리는 이벤트를 사용할 수 있다. 특히 비동기 이벤트를 사용하면 두 시스템 간의 결합을 크게 낮출 수 있다.  
